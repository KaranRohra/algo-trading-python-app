{% extends "base.html" %} {% block content %}
<div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-6">Logs</h1>
    <div class="overflow-x-auto">
        <table class="min-w-full bg-white shadow-md rounded-lg overflow-hidden">
            <thead class="bg-gray-800 text-white">
                <tr>
                    <th class="px-6 py-3 text-left text-sm font-medium">Timestamp</th>
                    <th class="px-6 py-3 text-left text-sm font-medium">Type</th>
                    <th class="px-6 py-3 text-left text-sm font-medium">Message</th>
                    <th class="px-6 py-S3 text-left text-sm font-medium">Details</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for log in logs %}
                <tr
                    class="{% if log.logType == 'ERROR' %}bg-red-50 text-red-800{% elif log.logType == 'INFO' %}bg-blue-50 text-blue-800{% elif log.logType == 'SUCCESS' %}bg-green-50 text-green-800{% elif log.logType == 'WARN' %}bg-yellow-50 text-yellow-800{% endif %}">
                    <td class="px-6 py-4 whitespace-nowrap">
                        {{ log.timestamp.split(".")[0] }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">{{ log.logType }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        {{ log.message | truncate(50, True, '...') }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        {% if log.details %}
                        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" onclick="showDetails('{{ log.timestamp.split('.')[0] }}', {{ log.details }})">
                            Show Details
                        </button>
                        {% else %}
                        <span class="text-gray-500">No details available</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <div class="mt-4">
        <nav class="flex justify-between">
            {% if page > 1 %}
            <a href="?page={{ page - 1 }}"
                class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">Previous</a>
            {% else %}
            <span
                class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded opacity-50 cursor-not-allowed">Previous</span>
            {% endif %}

            <span class="text-gray-800 font-bold py-2 px-4">Page {{ page }} of {{ total_pages }}</span>

            {% if page < total_pages %} <a href="?page={{ page + 1 }}"
                class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">Next</a>
                {% else %}
                <span
                    class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded opacity-50 cursor-not-allowed">Next</span>
                {% endif %}
        </nav>
    </div>
</div>

<!-- Modal for displaying log details -->
<div id="logDetailsModal" class="fixed inset-0 z-50 hidden bg-gray-800 bg-opacity-50 flex justify-center items-center">
    <div class="bg-white rounded-lg p-6 max-w-2xl w-full max-h-full overflow-y-auto">
        <h2 id="logDetailsTitle" class="text-xl font-bold mb-4">Log Details</h2>
        <pre id="logDetailsContent" class="whitespace-pre-wrap"></pre>
        <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded mt-4" onclick="closeModal()">
            Close
        </button>
    </div>
</div>
</div>

<script>

    function formatJson(json) {
        Object.keys(json).forEach((key) => {
            if (typeof json[key] === 'object') {
                json[key] = formatJson(json[key]);
            } else if (typeof json[key] === 'string' && json[key].includes('{')) {
                json[key] = JSON.parse(json[key]);
            }
        });
        return json;
    }
    function showDetails(timestamp, details) {
        // Update modal title with timestamp
        document.getElementById(
            "logDetailsTitle"
        ).textContent = `Log Details - ${timestamp}`;
        // Format details for better readability
        document.getElementById("logDetailsContent").textContent = JSON.stringify(
            formatJson(details),
            null,
            2
        );
        document.getElementById("logDetailsModal").classList.remove("hidden");
    }

    function closeModal() {
        document.getElementById("logDetailsModal").classList.add("hidden");
    }
</script>
{% endblock %}